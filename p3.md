# Buddy Memory Allocation Lab

## Learning Outcomes
- **2.1** Demonstrate how low-level memory is managed in user space.
- **2.2** Explore the system call interface.
- **3.1** Analyze a complex computing problem and apply principles of computing and other relevant disciplines to identify solutions.

## Tasks
### Task 1 - Implement Buddy Algorithm
You must implement the **Buddy Algorithm** using **bit shifting** and **masking** for calculations.  
❗ **WARNING:** You **cannot** use functions from the math library (e.g., `pow()` or `log2()`).

### Task 2 - Write Unit Tests
Ensure extensive testing by adding **enough test cases** to get **close to 100% coverage**.

## Additional Resources
### Buddy Calculation Example (Knuth’s Book)
To compute the buddy of a block of size **16** (`K=4`), use bitwise operations:

```
101110010110000
^ 000000000010000
------------------
  101110010100000
```

### Knuth Notation to C Syntax Quick Reference
| Knuth Notation | C Syntax |
|---------------|----------|
| `AVAILF[k]`   | `pool->avail[k].next` |
| `AVAILB[k]`   | `pool->avail[k].prev` |
| `LOC(AVAIL[k])` | `&pool->avail[k]` |
| `LINKF(L)` | `L->next` |
| `LINKB(L)` | `L->prev` |
| `TAG(L)` | `L->tag` |
| `KVAL(L)` | `L->kval` |
| `buddyk(L)` | `buddy_calc(pool, L);` |

### Power of 2 Reference Table
| K Value | Bytes | KiB/MiB/GiB |
|---------|-------|------------|
| 2^0 | 1 | - |
| 2^10 | 1,024 | 1 KiB |
| 2^20 | 1,048,576 | 1 MiB |
| 2^30 | 1,073,714,824 | 1 GiB |
| 2^40 | 1,099,511,627,776 | 1 TiB |

### Hints
- **Avoid hardcoded constants.** Use macros (`UINT64_C(1) << kval`).
- **Consider header size when calculating K values.** A request for **32 bytes** needs `K=6`, **not** `K=5`.
- **Memory allocation failure:** `buddy_malloc()` should set `errno = ENOMEM` and return `NULL`.
- **Strict memory management:** You **cannot** use `malloc()`, `free()`, `realloc()`, or `calloc()` from the standard library.
- **Pointer arithmetic is essential.** Be mindful of struct sizes:
  ```c
  sizeof(struct foo)  // Size of struct
  sizeof(struct foo*) // Size of pointer
  ```

## Debugging Raw Memory
When debugging in **VSCode**, you may need to **cast pointers** to dynamically allocated arrays:

```c
(struct avail(*) [9]) pool->avail;
```

For plain arrays:
```c
*(int(*)[10]) A
```
